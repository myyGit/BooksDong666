
@{
    Layout = null;
}
@using QX_Frame.Data.DTO;
@{
    List<BookViewModel> bookList = Model as List<BookViewModel>;
    int count = bookList.Count;
    var user = Session["uid"] == null ? 0 : 1;
}
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>古籍列表</title>
    <link href="~/New/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/H-ui/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="~/H-ui/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="~/lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="~/H-ui/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="~/H-ui/h-ui.admin/css/style.css" />

    <script src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/vue.min.js"></script>
    <script src="~/Scripts/common.js"></script>
    <style>
        body {
            background: url(/New/images/geometry2.png) repeat;
        }
    </style>
</head>
<body>
    <div style="width: 70%; margin: 0 auto;padding-top: 30px;">
        <form id="form" class="form-horizontal col-sm-9 float-lt form" action="@Url.Action("List","Article")" method="post">
            <div class="input-group">
                <select class="form-control float-lt" style="width: 30%;" name="categoryId">
                    <option value="0">全部</option>
                    <option value="1">书名</option>
                    <option value="2">作者</option>
                    <option value="3">出版者</option>
                    <option value="4">朝代</option>
                    <option value="5">其他名称</option>
                </select>
                <input type="text" class="form-control" name="title" style="width: 70%;">
                <a href="javascript:void(0)" class="input-group-addon " onclick="Submit()"><i class="Hui-iconfont">&#xe665;</i></a>
            </div>

        </form>
        <div class="col-sm-3 search" style="line-height:34px;">
            <a href="@Url.Action("MuchList", "Article")" style="color:indianred">多条件搜索</a>
        </div>
        <table class="table table-bordered table-striped" style="margin-top: 10px;display: inline-table;">
            <thead>
                <tr>
                    <td>
                        题名
                    </td>
                    <td>
                        其他题名
                    </td>
                    <td>
                        卷数
                    </td>
                    <td>
                        朝代
                    </td>
                    <td>
                        责任者
                    </td>
                    <td>
                        分类
                    </td>
                    <td>
                        版本
                    </td>
                    <td>
                        出版者
                    </td>
                    <td>
                        操作
                    </td>
                </tr>
            </thead>
            <tbody>
                <tr class="text-c">
                    <td class="text-l">
                        <a style="cursor:pointer" class="text-primary" href="@Url.Action("Detail","Article",new { id=new Guid()})" target="_blank" title="查看">12312312</a>
                    </td>
                    <td>别名 </td>
                    <td>阿达 </td>
                    <td>阿达 </td>
                    <td>唉顿时 </td>
                    <td>水电费 </td>
                    <td>2 </td>
                    <td> 阿斯顿发生导出 </td>
                    <td class="f-14 td-manage">
                        <a style="text-decoration:none" href="/Article/Read/123123" target="_blank" title="阅读"><i class="Hui-iconfont">&#xe720;</i></a>
                        <a style="text-decoration:none" href="/Article/DownLoadImages/12312?title=123123" title="下载" ><i class="Hui-iconfont">&#xe641;</i></a>
                    </td>
                </tr>
                @{
                    foreach (var item in bookList)
                    {
                        <tr class="text-c">
                            <td class="text-l">
                                <a style="cursor:pointer" class="text-primary" href="@(user == 0 ? Url.Action("Login","User") : Url.Action("Detail","Article",new { id=item.BookUid}))" target="_blank" title="查看">@item.Title</a>
                            </td>
                            <td>@item.Title2</td>
                            <td>@item.Volume</td>
                            <td>@item.Dynasty</td>
                            <td>@item.Functionary</td>
                            <td>@item.CategoryName</td>
                            <td>@item.Version</td>
                            <td>@item.Publisher</td>
                            <td class="f-14 td-manage">
                                <a style="text-decoration:none" href="@(user == 0 ? Url.Action("Login","User") : " /Article/Read/"+item.BookUid)" target="_blank" title="阅读"><i class="Hui-iconfont">&#xe720;</i></a>
                                <a style="text-decoration:none" onclick="Dowm(@item.BookUid,@item.Title)" href="javascript:void(0)" title="下载" class="glyphicon glyphicon-download"></a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
        <div class="pagination pager">
            <ul>
                <li><a href="#">Prev</a></li>
                <li class="active">
                    <a href="#">1</a>
                </li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">Next</a></li>
            </ul>
        </div>
    </div>
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="~/lib/My97DatePicker/4.8/WdatePicker.js"></script>
    <script type="text/javascript" src="~/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="~/lib/laypage/1.2/laypage.js"></script>
    <script src="~/Scripts/ajaxfileupload.js"></script>
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript">
        var user =@(Session["uid"] == null ? "" : "1");

        function Dowm(BookUid, Title) {
            if (user == "") {
                alert("请先登录");
                window.location = "@Url.Action("Login","User")";
            } else {
                window.location = "/Article/DownLoadImages/"+BookUid+"?title="+ Title+"";
            }
        }
        function Submit() {
            $("#form").submit();
        }
        /*古籍-阅读*/
        function article_show(title, url, w, h) {
            var index = layer.open({
                type: 2,
                title: title,
                content: url
            });
            layer.full(index);
        }
        /*古籍-添加*/
        function article_add(title, url, w, h) {
            var index = layer.open({
                type: 2,
                title: title,
                content: url
            });
            layer.full(index);
        }
        /*古籍-编辑*/
        function article_edit(title, url, id, w, h) {
            var index = layer.open({
                type: 2,
                title: title,
                content: url
            });
            layer.full(index);
        }
        /*古籍-删除*/
        function article_del(obj, id) {
            layer.confirm('确认要删除吗？', function (index) {
                $.ajax({
                    type: 'POST',
                    url: '/Article/DeleteDeal/' + id,
                    dataType: 'json',
                    success: function (data) {
                        if (data.isSuccess) {
                            $(obj).parents("tr").remove();
                            layer.msg('已删除!', { icon: 1, time: 1000 });
                            location.replace(location.href);//refresh
                        }
                        else {
                            layer.msg('删除失败!', { icon: 1, time: 1000 });
                        }
                    },
                    error: function (data) {
                        console.log(data.msg);
                    },
                });
            });
        }

        /*古籍-审核*/
        function article_shenhe(obj, id) {
            layer.confirm('审核文章？', {
                btn: ['通过', '不通过', '取消'],
                shade: false,
                closeBtn: 0
            },
                function () {
                    $(obj).parents("tr").find(".td-manage").prepend('<a class="c-primary" onClick="article_start(this,id)" href="javascript:;" title="申请上线">申请上线</a>');
                    $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已发布</span>');
                    $(obj).remove();
                    layer.msg('已发布', { icon: 6, time: 1000 });
                },
                function () {
                    $(obj).parents("tr").find(".td-manage").prepend('<a class="c-primary" onClick="article_shenqing(this,id)" href="javascript:;" title="申请上线">申请上线</a>');
                    $(obj).parents("tr").find(".td-status").html('<span class="label label-danger radius">未通过</span>');
                    $(obj).remove();
                    layer.msg('未通过', { icon: 5, time: 1000 });
                });
        }
        /*古籍-下架*/
        function article_stop(obj, id) {
            layer.confirm('确认要下架吗？', function (index) {
                $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="article_start(this,id)" href="javascript:;" title="发布"><i class="Hui-iconfont">&#xe603;</i></a>');
                $(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已下架</span>');
                $(obj).remove();
                layer.msg('已下架!', { icon: 5, time: 1000 });
            });
        }

        /*古籍-发布*/
        function article_start(obj, id) {
            layer.confirm('确认要发布吗？', function (index) {
                $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="article_stop(this,id)" href="javascript:;" title="下架"><i class="Hui-iconfont">&#xe6de;</i></a>');
                $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已发布</span>');
                $(obj).remove();
                layer.msg('已发布!', { icon: 6, time: 1000 });
            });
        }
        /*古籍-申请上线*/
        function article_shenqing(obj, id) {
            $(obj).parents("tr").find(".td-status").html('<span class="label label-default radius">待审核</span>');
            $(obj).parents("tr").find(".td-manage").html("");
            layer.msg('已提交申请，耐心等待审核!', { icon: 1, time: 2000 });
        }

    </script>
    <!--_footer 作为公共模版分离出去-->
    @*<script type="text/javascript" src="~/lib/jquery/1.9.1/jquery.min.js"></script>*@
    <script type="text/javascript" src="~/lib/layer/2.4/layer.js"></script>
    <script type="text/javascript" src="~/H-ui/h-ui/js/H-ui.min.js"></script>
    <script type="text/javascript" src="~/H-ui//h-ui.admin/js/H-ui.admin.js"></script>
    <!--/_footer 作为公共模版分离出去-->
</body>
</html>
